<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>lib/baseObject.js - hodman</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="hodman"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.9.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/BaseObject.html">BaseObject</a></li>
            
                <li><a href="../classes/CabbieAdapter.html">CabbieAdapter</a></li>
            
                <li><a href="../classes/DriverAdapter.html">DriverAdapter</a></li>
            
                <li><a href="../classes/GenericPageObject.html">GenericPageObject</a></li>
            
                <li><a href="../classes/PageObject.html">PageObject</a></li>
            
                <li><a href="../classes/PanelObject.html">PanelObject</a></li>
            
                <li><a href="../classes/ServiceBaseObject.html">ServiceBaseObject</a></li>
            
                <li><a href="../classes/ServiceContainer.html">ServiceContainer</a></li>
            
                <li><a href="../classes/ServiceContainerObject.html">ServiceContainerObject</a></li>
            
                <li><a href="../classes/ServiceEndPoint.html">ServiceEndPoint</a></li>
            
                <li><a href="../classes/ServiceEndPointObject.html">ServiceEndPointObject</a></li>
            
                <li><a href="../classes/ServiceEntry.html">ServiceEntry</a></li>
            
                <li><a href="../classes/ServiceList.html">ServiceList</a></li>
            
                <li><a href="../classes/ServiceLookup.html">ServiceLookup</a></li>
            
                <li><a href="../classes/ServiceNewEntry.html">ServiceNewEntry</a></li>
            
                <li><a href="../classes/ServiceObject.html">ServiceObject</a></li>
            
                <li><a href="../classes/ServiceRequest.html">ServiceRequest</a></li>
            
                <li><a href="../classes/StoreBase.html">StoreBase</a></li>
            
                <li><a href="../classes/StoreLookup.html">StoreLookup</a></li>
            
                <li><a href="../classes/ViewObject.html">ViewObject</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: lib/baseObject.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
// Copyright 2014, Yahoo! Inc.
// Copyrights licensed under the Mit License. See the accompanying LICENSE file for terms.

var nodePath = require(&#x27;path&#x27;);

var PNGImage = require(&#x27;pngjs-image&#x27;);
var Promise = require(&#x27;promise&#x27;);
var _ = require(&#x27;underscore&#x27;);

var Base = require(&#x27;preceptor-core&#x27;).Base;
var utils = require(&#x27;preceptor-core&#x27;).utils;

/**
 * @class BaseObject
 * @extends Base
 *
 * @property {Element} _context
 * @property {string[]} _loadSelectors
 * @property {object} _selectors
 */
var BaseObject = Base.extend(

	/**
	 * Base-Object constructor
	 *
	 * @constructor
	 * @param {Element} context
	 * @param {int} [timeOut]
	 * @param {int} [waitInMs]
	 */
	function (context, timeOut, waitInMs) {
		this.__super();

		this._context = context;
		this._loadSelectors = [];
		this._selectors = {};

		this.initialize();

		this.verifyIsLoaded(timeOut, waitInMs);
	},

	{
		/**
		 * Initializes the base-object
		 */
		initialize: function () {
			// Nothing by default
		},


		/**
		 * Verifies that the page-object and its sub-dom-elements are loaded as expected
		 *
		 * @param {int} [timeOut]
		 * @param {int} [waitInMs]
		 * @returns {BaseObject}
		 */
		verifyIsLoaded: function (timeOut, waitInMs) {
			return this.waitForElements(this._loadSelectors, timeOut, waitInMs);
		},


		/**
		 * Adds multiple load selectors, elements that should be selected when object is loaded
		 *
		 * @param {string[]} selectors
		 * @returns {BaseObject}
		 */
		addLoadSelectors: function (selectors) {
			_.each(selectors, function (selector) {
				this.addLoadSelector(selector);
			}, this);
			return this;
		},

		/**
		 * Adds a single load selector, elements that should be selected when object is loaded
		 *
		 * @param {string} selector
		 * @returns {BaseObject}
		 */
		addLoadSelector: function (selector) {
			if (!this.hasSelector) {
				throw new Error(&#x27;Cannot add an unknown selector to the load selector list: &#x27; + selector);
			}
			this._loadSelectors.push(selector);
			return this;
		},


		/**
		 * Get the page-object context
		 *
		 * @returns {Element}
		 */
		getContext: function () {
			return this._context;
		},

		/**
		 * Gets the web-driver adapter
		 *
		 * @returns {DriverAdapter}
		 */
		getAdapter: function () {
			return BaseObject.getDriverAdapter();
		},


		/**
		 * Get a list of all selectors
		 *
		 * @returns {object}
		 */
		getSelectors: function () {
			return this._selectors;
		},

		/**
		 * Sets the selectors
		 *
		 * @param {object} selectors
		 */
		setSelectors: function (selectors) {
			this._selectors = selectors;
		},

		/**
		 * Gets a specific selector by name
		 *
		 * @param {string} selectorName
		 * @returns {string}
		 */
		getSelector: function (selectorName) {
			var selectors = this.getSelectors();
			return selectors[selectorName];
		},

		/**
		 * Does it have a specific selector by name
		 *
		 * @param {string} selectorName
		 * @returns {boolean}
		 */
		hasSelector: function (selectorName) {
			var selectors = this.getSelectors();
			return !!selectors[selectorName];
		},


		/**
		 * Gets an element by a selector name
		 *
		 * @param {string} selectorName
		 * @returns {Element}
		 */
		getElement: function (selectorName) {
			var context = this.getContext(),
				selector = this.getSelector(selectorName);

			return this.getAdapter().getElement(context, selector, &#x27;css selector&#x27;);
		},

		/**
		 * Checks if a selector name does exist in the selector list
		 *
		 * @param {string} selectorName
		 * @returns {boolean}
		 */
		hasElement: function (selectorName) {
			var context = this.getContext(),
				selector = this.getSelector(selectorName);

			return (this.getAdapter().getElements(context, selector, &#x27;css selector&#x27;).length !== 0);
		},

		/**
		 * Waits for the element to appear on the page
		 *
		 * @param {string[]} selectors
		 * @param {int} [timeOut=10000]
		 * @param {int} [waitInMs=500]
		 * @returns {BaseObject}
		 */
		waitForElements: function (selectors, timeOut, waitInMs) {

			this.waitUntil(function () {

				var allLoaded = true;

				_.each(selectors, function (selector) {
					if (allLoaded) {
						allLoaded = allLoaded &amp;&amp; this.hasElement(selector);
					}
				}, this);

				return allLoaded;

			}.bind(this), timeOut, waitInMs);

			return this;
		},


		/**
		 * Wait until a callback returns a truthy value
		 *
		 * @param {function} fn
		 * @param {int} [timeOut=10000]
		 * @param {int} [waitInMs=500]
		 * @returns {BaseObject}
		 */
		waitUntil: function (fn, timeOut, waitInMs) {

			var startTime = (+new Date()),
				result;

			timeOut = timeOut || 10000;
			waitInMs = waitInMs || 500;

			result = fn();
			if (result &amp;&amp; result.then) {
				// TODO: Make it &quot;Promise safe&quot;
			} else {

				while (!fn()) {

					if ((+new Date()) - startTime &gt;= timeOut) {
						throw new Error(&quot;Waited for an event, but timed-out.&quot;);
					}

					this.getAdapter().sleep(waitInMs);
				}
			}

			return this;
		},


		/**
		 * Get the coordinates and size of an element
		 *
		 * @param {string} [selectorName] Defaults to current context
		 * @returns {object} &#x60;{x: int, y: int, width: int, height: int}&#x60;
		 */
		getFrame: function (selectorName) {
			var element;

			if (selectorName) {
				element = this.getElement(selectorName);
			} else {
				element = this.getContext();
			}

			if (element.getFrame) {
				return element.getFrame();
			} else {
				return { x: 0, y: 0, width: 0, height: 0 };
			}
		},


		/**
		 * List of blackout coordinates for the current page-object
		 *
		 * @returns {object[]}
		 */
		blackOut: function () {
			return [];
		},

		/**
		 * Captures the current page-object
		 *
		 * @param {string} title Title of test or part of identifier
		 * @param {string} [id=&#x27;1&#x27;] Identifier for screenshot file
		 * @param {int} [wait=1000] Wait before a screenshot is taken
		 * @returns {Promise}
		 */
		capture: function (title, id, wait) {

			var self = this, image, promise,
				blackOutList, frame, buffer,
				fileName, path, prefix;

			this.getAdapter().sleep(wait || 1000);

			blackOutList = this.blackOut();
			frame = this.getFrame();
			buffer = this.getAdapter().takeScreenshot();
			prefix = BaseObject.getScreenshotPrefix();

			fileName = utils.fileNameSafe(title) + &#x27;_&#x27; + utils.fileNameSafe(id || &#x27;1&#x27;) + &#x27;.png&#x27;;
			if (prefix) {
				fileName = utils.fileNameSafe(prefix) + &#x27;_&#x27; + fileName;
			}
			path = nodePath.join(BaseObject.getScreenshotPath(), fileName);

			promise = new Promise(function (resolve, reject) {

				try {

					image = PNGImage.loadImage(buffer, function (err) {

						var i, len;

						if (err) {
							throw err;
						}

						// Fill-in areas for black-out
						for (i = 0, len = blackOutList.length; i &lt; len; i++) {
							image.fillRect(blackOutList[i].x, blackOutList[i].y, blackOutList[i].width, blackOutList[i].height, {
								red: 0,
								green: 0,
								blue: 0,
								alpha: 255
							});
						}

						// Clip screenshot to the area of the context
						if ((frame.width !== 0) &amp;&amp; (frame.height !== 0)) {
							image.clip(frame.x, frame.y, frame.width, frame.height);
						}

						// Write to disk
						image.writeImage(path, function (err) {

							if (err) {
								throw err;
							}

							resolve(self);

						});
					});

				} catch (err) {
					reject(err);
				}
			});

			return promise;
		}
	},

	{
		/**
		 * @var string
		 */
		TYPE: &#x27;BaseObject&#x27;,

		/**
		 * Gets the path for the screenshot results
		 *
		 * @var {string}
		 */
		getScreenshotPath: function () {
			return this.SCREENSHOT_PATH || global.SCREENSHOT_PATH || process.env.SCREENSHOT_PATH;
		},

		/**
		 * Gets the screenshot prefix
		 *
		 * @var {string}
		 */
		getScreenshotPrefix: function () {
			return this.SCREENSHOT_PREFIX || global.SCREENSHOT_PREFIX || process.env.SCREENSHOT_PREFIX;
		},

		/**
		 * Gets the web-driver adapter
		 *
		 * @return {DriverAdapter}
		 */
		getDriverAdapter: function () {
			return this.DRIVER_ADAPTER || global.DRIVER_ADAPTER;
		}
	});

module.exports = BaseObject;

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
